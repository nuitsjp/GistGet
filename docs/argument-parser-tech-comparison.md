# 引数パーサー技術比較: ConsoleAppFramework vs System.CommandLine

## 概要

フェーズ2での引数パーサー実装において、どちらの技術を採用するかの技術調査結果です。

## 比較項目

| 項目 | ConsoleAppFramework | System.CommandLine |
|------|---------------------|-------------------|
| **安定性** | ✅ 安定版 5.2.4 | ⚠️ Beta版 (2.0.0-beta4) |
| **Microsoft公式** | ❌ サードパーティ | ✅ Microsoft公式 |
| **WinGet互換性** | 🔧 カスタム実装必要 | 🔧 カスタム実装必要 |
| **学習コスト** | ✅ 低い | ⚠️ 中程度 |
| **パフォーマンス** | ✅ 高い | ✅ 高い |
| **コマンド階層** | 🔧 手動実装 | ✅ ネイティブサポート |
| **バリデーション** | 🔧 カスタム実装 | ✅ 豊富な組み込み機能 |
| **ヘルプ生成** | ✅ 自動生成 | ✅ 自動生成 |

## 詳細分析

### ConsoleAppFramework

**メリット:**
- 安定版で本番環境で使用可能
- シンプルなAPIで学習コストが低い
- 高いパフォーマンス
- 豊富な実績とコミュニティサポート

**デメリット:**
- WinGetの複雑な引数構造には追加実装が必要
- サブコマンド階層の実装が手動
- 複雑なバリデーション機能が限定的
- Microsoft公式ではないため長期サポートの懸念

### System.CommandLine

**メリット:**
- Microsoft公式ライブラリで将来性が高い
- サブコマンド階層のネイティブサポート
- 豊富なバリデーション機能
- WinGetのような複雑なCLI構造に適している
- 詳細なヘルプとドキュメント生成

**デメリット:**
- 現在Beta版で本番利用にリスクがある
- API変更の可能性
- 学習コストがやや高い
- まだ新しいライブラリで事例が少ない

## 推奨結論: System.CommandLine

### 選定理由

1. **WinGet互換性**: WinGetの複雑なサブコマンド構造（`winget source add`, `winget settings export`など）にSystem.CommandLineの階層サポートが最適

2. **Microsoft公式**: .NET 8プロジェクトとしてMicrosoft公式ライブラリを使用することで技術的一貫性を確保

3. **将来性**: Beta版だが、Microsoft公式として長期サポートが期待される

4. **機能性**: WinGetの複雑な引数バリデーション（相互排他性、条件付きオプション）を効率的に実装可能

### リスク軽減策

1. **Beta版リスク**: 
   - 安定版リリースまでの移行計画を準備
   - API変更への対応体制を整備
   
2. **実装複雑性**:
   - 段階的実装（MVP → フル機能）
   - 包括的なテスト戦略

## 実装方針

1. **第1段階**: System.CommandLineで基本5コマンド実装
2. **第2段階**: 全18コマンドへの拡張
3. **第3段階**: WinGet完全互換のバリデーション実装

この選択により、WinGetの複雑な引数構造を効率的に実装し、Microsoft公式としての技術的一貫性を保持できます。